# –¢—å—é—Ç–æ—Ä–∏–∞–ª: –û—Å–Ω–æ–≤—ã MLFlow –¥–ª—è Data Science

## **üëÄ¬†–û–ø–∏—Å–∞–Ω–∏–µ**

üéì **–ß—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ?** "–û—Å–Ω–æ–≤—ã MLFlow –¥–ª—è Data Science" - —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ –Ω–∞–±–æ—Ä –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π, —ç—Ç–æ –Ω–∞—Å—Ç–æ—è—â–∏–π —Ç—å—é—Ç–æ—Ä–∏–∞–ª, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–≥—Ä—É–∑–∏—Ç –≤–∞—Å –≤ –º–∏—Ä MLflow. –≠—Ç–æ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –≥–∏–¥, –ø–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä–æ–≤ –∏ —Å–æ–≤–µ—Ç–æ–≤, —á—Ç–æ–±—ã –≤—ã –º–æ–≥–ª–∏ –ª–µ–≥–∫–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å MLflow –≤ –≤–∞—à–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö –ø–æ Data Science. 

üë©üèª‚Äçüíª **–î–ª—è –∫–æ–≥–æ —ç—Ç–æ—Ç —Ç—å—é—Ç–æ—Ä–∏–∞–ª?** –ï—Å–ª–∏ –≤—ã Data Scientist –∏–ª–∏ ML Engineer, —Ç–æ —ç—Ç–æ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª —Ç–æ—á–Ω–æ –¥–ª—è –≤–∞—Å. –ù–µ–≤–∞–∂–Ω–æ, –Ω–æ–≤–∏—á–æ–∫ –≤—ã –∏–ª–∏ —É–∂–µ —Å –æ–ø—ã—Ç–æ–º, –∑–¥–µ—Å—å –Ω–∞–π–¥–µ—Ç—Å—è –º–Ω–æ–≥–æ –ø–æ–ª–µ–∑–Ω–æ–≥–æ –∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–≥–æ.

**üéØ¬†–ß—Ç–æ –≤—ã —É–∑–Ω–∞–µ—Ç–µ?**

- –ö–∞–∫ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –≤–∞–∂–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –≤–∞—à–∏—Ö –º–æ–¥–µ–ª–µ–π —Å –ø–æ–º–æ—â—å—é MLFlow.
- –°–æ–∑–¥–∞–≤–∞—Ç—å, —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å ML —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–º–∏.
- –†–∞–∑–±–∏—Ä–∞—Ç—å—Å—è –≤ –º–µ—Ç—Ä–∏–∫–∞—Ö –∏ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞—Ö –∑–∞–ø—É—Å–∫–æ–≤ –º–æ–¥–µ–ª–µ–π.
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Model Registry –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–æ–¥–µ–ª—è–º–∏.

üîç **–ö–∞–∫ —ç—Ç–æ —É—Å—Ç—Ä–æ–µ–Ω–æ?** –í–∞–º –Ω–µ –ø—Ä–∏–¥–µ—Ç—Å—è –¥–æ–ª–≥–æ –∏—Å–∫–∞—Ç—å –Ω—É–∂–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é. –¢—å—é—Ç–æ—Ä–∏–∞–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –∏—Å—á–µ—Ä–ø—ã–≤–∞—é—â–∏–µ –ø—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞ –∏ –ø–æ—à–∞–≥–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ Markdown.

‚è±Ô∏è **–°–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –Ω—É–∂–Ω–æ?** –í—Å–µ–≥–æ 30 –º–∏–Ω—É—Ç - –∏ –≤—ã —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç–µ —Å–≤–æ–∏ –∑–Ω–∞–Ω–∏—è –∏ –Ω–∞–≤—ã–∫–∏ –≤ MLflow.


## **üë©‚Äçüíª Installation**

First, install the pre-built example. Check the origin README file for more technical details and notes. 

**1. Fork / Clone this repository**

Clone the repository with the example code.

```bash
git clone https://gitlab.com/risomaschool/tutorials-raif/mlflow-1-metrics-tracking.git
cd mlflow-1-metrics-tracking
```

**2. Create a virtual environment**

This example requires Python 3.9 or above. 

```bash
python3 -m venv .venv
echo "export PYTHONPATH=$PWD" >> .venv/bin/activate
source .venv/bin/activate
pip install --upgrade pip setuptools wheel
pip install -r requirements-dev.txt
```

1.  **Download data**

This is a preparation step. Load data from [https://archive.ics.uci.edu/ml/datasets/bike+sharing+dataset](https://archive.ics.uci.edu/ml/datasets/bike+sharing+dataset) to the `data/` directory

```bash
python src/pipelines/load_data.py
```

4. **Launch MLflow UI**

To start the MLflow UI, run:

```bash
mlflow ui
```

And then navigate to [http://localhost:5000](http://localhost:5000) in your browser

5. **Run the Jupyter Lab or Jupyter Notebook**

```bash
jupyter lab
```

## ****üöÄ**** 1 - –¢—Ä–µ–∫–∏–Ω–≥ –º–µ—Ç—Ä–∏–∫ –≤ MLFlow

<aside>
üí° –ú—ã –Ω–∞—á–Ω–µ–º –∑–Ω–∞–∫–æ–º—Å—Ç–≤–æ —Å MLFlow –≤ Jupyter Notebook `notebooks/1-get-started.ipynb`

</aside>

–í —ç—Ç–æ–π —á–∞—Å—Ç–∏ –º—ã —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –º–µ—Ç—Ä–∏–∫ —Å –ø–æ–º–æ—â—å—é MLflow. MLflow Tracking - —ç—Ç–æ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –º–µ—Ç—Ä–∏–∫, –∫–æ—Ç–æ—Ä–∞—è —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∫–∞–∫ Python –ø–∞–∫–µ—Ç –∏ –ª–µ–≥–∫–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è –≤ –∫–æ–¥ –ø—Ä–æ–µ–∫—Ç–∞. 

–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏: 

- Log metrics, params, and artifacts to MLFlow.
- Log, register, and load models using a local MLflow Tracking Server.
- Interact with the MLflow Tracking Server using the MLflow fluent API.
- Perform inference on Pandas DataFrames by loading models as generic Python Functions (pyfunc).

### –®–∞–≥ 1 - –û–±—É—á–∏–º –º–æ–¥–µ–ª—å –∏ –ø–æ—Å—á–∏—Ç–∞–µ–º –º–µ—Ç—Ä–∏–∫–∏

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —è—á–µ–π–∫–∏ –≤ —Ä–∞–∑–¥–µ–ª–µ ‚ÄúTrain model and calculate metrics‚Äù.  –ú—ã –Ω–µ –±—É–¥–µ–º –¥–µ—Ç–∞–ª—å–Ω–æ —Ä–∞–∑–±–∏—Ä–∞—Ç—å –∫–æ–¥ —ç—Ç–æ–≥–æ —Ä–∞–∑–¥–µ–ª–µ. –ù–∞–¥–µ–µ–º—Å—è, —á—Ç–æ –ø—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–æ—Å—Ç—ã. 

–ü—Ä–∏–º–µ—Ä –æ–ø–∏—Å—ã–≤–∞–µ—Ç —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –¥–ª—è —Ç–∏–ø–∏—á–Ω–æ–≥–æ Data Science –ø—Ä–æ–µ–∫—Ç–∞. –ù–∞ –≤—ã—Ö–æ–¥–µ —É –Ω–∞—Å –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–±—ä–µ–∫—Ç–æ–≤, –æ—Ç–Ω–æ—Å—è—â–∏—Ö—Å—è –∫ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—É —Å –º–æ–¥–µ–ª—å—é: 

- –¥–∞—Ç–∞—Å–µ—Ç—ã –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –º–æ–¥–µ–ª–∏
- –º–æ–¥–µ–ª—å
- –≥–∏–ø–µ—Ä-–ø–∞—Ä–∞–º–µ—Ç—Ä—ã –º–æ–¥–µ–ª–∏
- –º–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –º–æ–¥–µ–ª–∏

–î–ª—è —É–¥–æ–±–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å ML —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–º–∏ –Ω—É–∂–µ–Ω —Å–ø–æ—Å–æ–± –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤ –∏ —Ç—Ä–µ–∫–∏–Ω–≥–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤. MLFlow –∫–∞–∫ —Ä–∞–∑ –æ—Ç–ª–∏—á–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –¥–ª—è —ç—Ç–∏—Ö –∑–∞–¥–∞—á!  –¢—Ä–µ–∫–∏–Ω–≥ –º–µ—Ç—Ä–∏–∫ –∏ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤ –≤ MLFlow –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–∏—Å—Ç–µ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –º–æ–¥–µ–ª–µ–π –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è –ø–æ–≤—Ç–æ—Ä—è–µ–º–æ—Å—Ç—å, —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –∏ –∞–Ω–∞–ª–∏–∑ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤.

### –®–∞–≥ 2  - **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, –º–µ—Ç—Ä–∏–∫ –∏ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤**

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞ MLFlow**
–î–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã —Å MLFlow, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–µ—Ä–≤–µ—Ä —Ç—Ä–µ–∫–∏–Ω–≥–∞. –í –ø—Ä–æ—Å—Ç–µ–π—à–µ–º —Å–ª—É—á–∞–µ —ç—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å, –∏—Å–ø–æ–ª—å–∑—É—è –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä. –î–ª—è —ç—Ç–æ–≥–æ, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ URI —Ç—Ä–µ–∫–∏–Ω–≥–∞:

```python
MLFLOW_TRACKING_URI = "<http://localhost:5000>"
mlflow.set_tracking_uri(MLFLOW_TRACKING_URI)
```

**–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, –º–µ—Ç—Ä–∏–∫ –∏ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤**:
–ß—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Ç—Ä–µ–∫–∏–Ω–≥ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä `mlflow.start_run()`. –í —ç—Ç–æ–º –±–ª–æ–∫–µ –º–æ–∂–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–ª–∏—á–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ –º–µ—Ç—Ä–∏–∫–∏:

```python
with mlflow.start_run() as run:
    # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –º–æ–¥–µ–ª–∏
    mlflow.log_param('model', 'RandomForest')
    mlflow.log_params({'random_state': 0, 'n_estimators': 50})

    # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç—Ä–∏–∫
    mlflow.log_metric('me', round(me, 3))
    mlflow.log_metric('mae', round(mae, 3))

    # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤, –≤–∫–ª—é—á–∞—è –∏—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ –º–æ–¥–µ–ª—å
    mlflow.log_artifact("../data/raw_data.csv")
    mlflow.log_artifact("../models/model.joblib")

    # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ–≥–æ–≤ –¥–ª—è –±–æ–ª–µ–µ —É–¥–æ–±–Ω–æ–≥–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤
    mlflow.set_tag("random-forest", "Random Forest Classifier")

    # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–∏–≥–Ω–∞—Ç—É—Ä—ã –º–æ–¥–µ–ª–∏
    signature = infer_signature(X_train, model.predict(X_train))

    # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∞–º–æ–π –º–æ–¥–µ–ª–∏
    model_info = mlflow.sklearn.log_model(
        sk_model=model,
        artifact_path="rf_model",
        signature=signature,
        input_example=X_train,
        registered_model_name="1-get-started-random-forest",
    )

```

–î–∞–Ω–Ω—ã–π –±–ª–æ–∫ –∫–æ–¥–∞ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ MLFlow –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∞—Å–ø–µ–∫—Ç–æ–≤ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞ —Å –º–∞—à–∏–Ω–Ω—ã–º –æ–±—É—á–µ–Ω–∏–µ–º. –î–∞–≤–∞–π—Ç–µ —Ä–∞–∑–±–µ—Ä–µ–º –µ–≥–æ –ø–æ —á–∞—Å—Ç—è–º:

1. **–ù–∞—á–∞–ª–æ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞**:
    
    ```python
    with mlflow.start_run() as run:
    
    ```
    
    –≠—Ç–∞ —Å—Ç—Ä–æ–∫–∞ –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç –Ω–æ–≤—ã–π —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç (–∏–ª–∏ "–∑–∞–ø—É—Å–∫") –≤ MLFlow. `with` –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –≤—Å–µ, —á—Ç–æ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ —ç—Ç–æ–≥–æ –±–ª–æ–∫–∞, –±—É–¥–µ—Ç –æ—Ç–Ω–æ—Å–∏—Ç—å—Å—è –∫ —Ç–µ–∫—É—â–µ–º—É —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—É. –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –±–ª–æ–∫–∞, —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è.
    
2. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –º–æ–¥–µ–ª–∏**:
    
    ```python
    mlflow.log_param('model', 'RandomForest')
    mlflow.log_params({'random_state': 0, 'n_estimators': 50})
    
    ```
    
    –ó–¥–µ—Å—å –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –º–æ–¥–µ–ª–∏. `log_param` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∑–∞–ø–∏—Å–∏ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞, –∞ `log_params` - –¥–ª—è –∑–∞–ø–∏—Å–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.
    
3. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç—Ä–∏–∫**:
    
    ```python
    mlflow.log_metric('me', round(me, 3))
    mlflow.log_metric('mae', round(mae, 3))
    
    ```
    
    –≠—Ç–∏ —Å—Ç—Ä–æ–∫–∏ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç –º–µ—Ç—Ä–∏–∫–∏ –º–æ–¥–µ–ª–∏. –í –ø—Ä–∏–º–µ—Ä–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –º–µ—Ç—Ä–∏–∫–∏ `me` (—Å—Ä–µ–¥–Ω—è—è –æ—à–∏–±–∫–∞) –∏ `mae` (—Å—Ä–µ–¥–Ω—è—è –∞–±—Å–æ–ª—é—Ç–Ω–∞—è –æ—à–∏–±–∫–∞), –æ–∫—Ä—É–≥–ª–µ–Ω–Ω—ã–µ –¥–æ —Ç—Ä–µ—Ö –¥–µ—Å—è—Ç–∏—á–Ω—ã—Ö –∑–Ω–∞–∫–æ–≤.
    
4. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤**:
    
    ```python
    mlflow.log_artifact("../data/raw_data.csv")
    mlflow.log_artifact("../models/model.joblib")
    
    ```
    
    –ó–¥–µ—Å—å –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä, –∏—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (`raw_data.csv`) –∏ —Ñ–∞–π–ª –º–æ–¥–µ–ª–∏ (`model.joblib`).
    
    ‚ö†Ô∏èPlease, note that you need to pass the `model_path` to the `log_artifact` function, not the model object! The `log_artifact` function doesn‚Äôt know anything about the artifact you want to log.
    
5. **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ–≥–æ–≤**:
    
    ```python
    mlflow.set_tag("random-forest", "Random Forest Classifier")
    ```
    
    –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ–≥–æ–≤ –ø–æ–º–æ–≥–∞–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏ –ª–µ–≥–∫–æ –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã –≤ MLFlow.
    
6. **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–∏–≥–Ω–∞—Ç—É—Ä—ã –º–æ–¥–µ–ª–∏**:
    
    ```python
    signature = infer_signature(X_train, model.predict(X_train))
    
    ```
    
    –°–∏–≥–Ω–∞—Ç—É—Ä–∞ –º–æ–¥–µ–ª–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ñ–æ—Ä–º–∞—Ç –≤—Ö–æ–¥–Ω—ã—Ö –∏ –≤—ã—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö. –≠—Ç–æ –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è —Ç–æ–≥–æ, –∫–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –º–æ–¥–µ–ª—å –æ–∂–∏–¥–∞–µ—Ç –Ω–∞ –≤—Ö–æ–¥ –∏ —á—Ç–æ –æ–Ω–∞ –≤—ã–¥–∞—ë—Ç –Ω–∞ –≤—ã—Ö–æ–¥–µ.
    
7. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∞–º–æ–π –º–æ–¥–µ–ª–∏**:
    
    ```python
    model_info = mlflow.sklearn.log_model(
        sk_model=model,
        artifact_path="rf_model",
        signature=signature,
        input_example=X_train,
        registered_model_name="1-get-started-random-forest",
    )
    
    ```
    
    –ó–¥–µ—Å—å –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è —Å–∞–º–∞ –º–æ–¥–µ–ª—å. –≠—Ç–æ—Ç —à–∞–≥ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –º–æ–¥–µ–ª—å –≤ MLFlow, –≤–∫–ª—é—á–∞—è –µ—ë —Å–∏–≥–Ω–∞—Ç—É—Ä—É –∏ –ø—Ä–∏–º–µ—Ä –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–∑–∂–µ –ª–µ–≥–∫–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–¥–µ–ª—å.
    

–í —Ü–µ–ª–æ–º, —ç—Ç–æ—Ç –∫–æ–¥ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –ø—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è MLFlow –¥–ª—è —Ç—Ä–µ–∫–∏–Ω–≥–∞ –≤—Å–µ—Ö –∫–ª—é—á–µ–≤—ã—Ö –∞—Å–ø–µ–∫—Ç–æ–≤ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞ —Å –º–∞—à–∏–Ω–Ω—ã–º –æ–±—É—á–µ–Ω–∏–µ–º.

### –®–∞–≥ 3  - MLflow UI

MLflow —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤—Å–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ —É–Ω–∏–∫–∞–ª—å–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ (run) –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Ö –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö. –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å MLflow –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤, –∞ —Ç–∞–∫–∂–µ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∑–∞–ø—É—Å–∫–∏ —Å –∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏. –ú–µ—Ç—Ä–∏–∫–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –≤ –≤–∏–¥–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤, —á—Ç–æ —É–ø—Ä–æ—â–∞–µ—Ç –∞–Ω–∞–ª–∏–∑ —Ç—Ä–µ–Ω–¥–æ–≤ –∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∑–Ω–∞—á–µ–Ω–∏—è—Ö –º–µ—Ç—Ä–∏–∫.

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é MLflow —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –≤—Å–µ –º–µ—Ç—Ä–∏–∫–∏ –∏ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –≤ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–µ **`Default`**.

![Untitled](docs/images/Untitled.png)

–ü–µ—Ä–µ–π–¥–∏—Ç–µ –∫ –Ω–µ–¥–∞–≤–Ω–æ —Å–æ–∑–¥–∞–Ω–Ω–æ–º—É –∑–∞–ø—É—Å–∫—É –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—ã —É—Å–ø–µ—à–Ω–æ –∑–∞–ª–æ–≥–∏—Ä–æ–≤–∞–ª–∏ –º–µ—Ç—Ä–∏–∫–∏ me –∏ mae, –∞ —Ç–∞–∫–∂–µ —Ñ–∞–π–ª model.joblib –≤ —Ä–∞–∑–¥–µ–ª–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤.

![Untitled](docs/images/Untitled%201.png)

### –®–∞–≥ 4  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ–≥–Ω–æ–∑–æ–≤

<aside>
üí° –≠—Ç–∞ —á–∞—Å—Ç—å –ø—Ä–∏–º–µ—Ä–∞ –º–æ–∂–µ—Ç –Ω–µ –ø–æ–¥–æ–π—Ç–∏ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ `production` –ø—Ä–æ—Ü–µ—Å—Å–∞—Ö. –û–¥–Ω–∞–∫–æ, —ç—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –∞–Ω–∞–ª–∏–∑–∞ –º–æ–¥–µ–ª–∏.

</aside>

–ü–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –º–æ–¥–µ–ª—å –æ–±—É—á–µ–Ω–∞ –∏ –∑–∞–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∞ –≤ MLFlow, —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥ - –µ—ë –∑–∞–≥—Ä—É–∑–∫–∞ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–æ–≥–Ω–æ–∑–æ–≤. –í —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ –º—ã —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º, –∫–∞–∫ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é –º–æ–¥–µ–ª—å –≤ –≤–∏–¥–µ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–π Python-—Ñ—É–Ω–∫—Ü–∏–∏ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ—ë –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –Ω–∞ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

**–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏ –∫–∞–∫ Python-—Ñ—É–Ω–∫—Ü–∏–∏**:
–í–º–µ—Å—Ç–æ —Ç–æ–≥–æ, —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∂–∞—Ç—å –º–æ–¥–µ–ª—å –æ–±—Ä–∞—Ç–Ω–æ –≤ –Ω–∞—Ç–∏–≤–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ scikit-learn —Å –ø–æ–º–æ—â—å—é `mlflow.sklearn.load_model()`, –º—ã –∑–∞–≥—Ä—É–∂–∞–µ–º –º–æ–¥–µ–ª—å –∫–∞–∫ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—É—é Python-—Ñ—É–Ω–∫—Ü–∏—é. –≠—Ç–æ –ø–æ–¥—Ö–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –æ–±—ã—á–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–Ω–ª–∞–π–Ω-—Ä–∞–∑–º–µ—â–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π, –Ω–æ –æ–Ω —Ç–∞–∫–∂–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –∏ –¥–ª—è –ø–∞–∫–µ—Ç–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.

```python
loaded_model = mlflow.pyfunc.load_model(model_info.model_uri)

```

–ó–¥–µ—Å—å `model_info.model_uri` —Å–æ–¥–µ—Ä–∂–∏—Ç URI –º–æ–¥–µ–ª–∏, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π –≤ MLFlow.

**–ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ–≥–Ω–æ–∑–æ–≤ –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –Ω–∞–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö**:
–¢–µ–ø–µ—Ä—å, –∫–æ–≥–¥–∞ –º–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –µ—ë –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–æ–≥–Ω–æ–∑–æ–≤ –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–º –Ω–∞–±–æ—Ä–µ –¥–∞–Ω–Ω—ã—Ö `X_test`.

```python
predictions = loaded_model.predict(X_test)

```

**–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –†–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–ª—è –ê–Ω–∞–ª–∏–∑–∞**:
–î–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π —É–¥–æ–±–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å DataFrame Pandas.

- **–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤ DataFrame**:
    
    ```python
    result = pd.DataFrame(X_test)  # –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∏–º–µ–Ω–∞ –∫–æ–ª–æ–Ω–æ–∫, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
    ```
    
- **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö –∫–ª–∞—Å—Å–æ–≤ –≤ DataFrame**:
    
    ```python
    result["actual_class"] = y_test
    
    ```
    
- **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π –º–æ–¥–µ–ª–∏ –≤ DataFrame**:
    
    ```python
    result["predicted_class"] = predictions
    
    ```
    

–ó–∞–≥—Ä—É–∑–∫–∞ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–æ–≥–Ω–æ–∑–æ–≤ - –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–π —ç—Ç–∞–ø –≤ —Ä–∞–±–æ—á–µ–º –ø—Ä–æ—Ü–µ—Å—Å–µ –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è. –ò—Å–ø–æ–ª—å–∑—É—è MLFlow, –º—ã –º–æ–∂–µ–º —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å –º–æ–¥–µ–ª—è–º–∏ –∏ –∏—Ö —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ–º, —á—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≥–∏–±–∫–æ—Å—Ç—å –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è.

## üöÄ 2 - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–º–∏ (Experiments) –∏ –∑–∞–ø—É—Å–∫–∞–º–∏ (Runs)

<aside>
üí° –í —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ –≤—ã –±—É–¥–µ—Ç–µ —Ä–∞–±–æ—Ç–∞—Ç—å —Å Jupyter Notebook `notebooks/2-manage-runs.ipynb`

</aside>

### –®–∞–≥ 1 - –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö

–ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ—Ç –∂–µ –¥–∞—Ç–∞—Å–µ—Ç, —á—Ç–æ –∏ –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–º –ø—Ä–∏–º–µ—Ä–µ. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —è—á–µ–π–∫–∏ —Ä–∞–∑–¥–µ–ª–∞ `2. Prepdate Data`

### Step 2 - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ MLflow Client

–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∫–ª–∏–µ–Ω—Ç MLflow –∏ –∑–∞–¥–∞–π—Ç–µ –∏–º—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞. –≠—Ç–æ —Å–æ–∑–¥–∞—Å—Ç –∏–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç –Ω–æ–≤—ã–π —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç MLflow –ø–æ–¥ –Ω–∞–∑–≤–∞–Ω–∏–µ–º "1-Train-K-Fold". –ü–æ–∑–¥–Ω–µ–µ –≤ MLflow Runs –±—É–¥—É—Ç –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å—Å—è –º–µ—Ç—Ä–∏–∫–∏ –∏ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã, –æ—Ç–Ω–æ—Å—è—â–∏–µ—Å—è –∫ —ç—Ç–æ–º—É —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—É. 

```python
# Set up MLFlow Client
MLFLOW_TRACKING_URI = "http://localhost:5000"
mlflow.set_tracking_uri(MLFLOW_TRACKING_URI)

client = MlflowClient()
print(f"Client tracking uri: {client.tracking_uri}")

# Set experiment name
mlflow.set_aexperiment('1-Train-K-Fold')
```

![Untitled](docs/images/Untitled%202.png)

### –®–∞–≥ 4 - –¢—Ä–µ–∫–∏–Ω–≥ –º–µ—Ç—Ä–∏–∫ –¥–ª—è K-Fold Cross Validation

–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å –æ–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ —Å K-Fold –∫—Ä–æ—Å—Å–≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –∏ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –≤ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç `1-Train-K-Fold`.  –î–∞–≤–∞–π—Ç–µ —Ä–µ–∞–ª–∏–∑–∞—É–µ–º —Ç–∞–∫–æ–π —Å—Ü–µ–Ω–∞—Ä–∏–π –¥–ª—è –∫–∞–∂–¥–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏ (Fold):

- –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –æ–±—É—á–∞—é—â–∏–π –∏ —Ç–µ—Å—Ç–æ–≤—ã–π –Ω–∞–±–æ—Ä—ã –¥–∞–Ω–Ω—ã—Ö.
- –û–±—É—á–∏—Ç—å –º–æ–¥–µ–ª—å, –∏—Å–ø–æ–ª—å–∑—É—è –æ–±—É—á–∞—é—â–∏–π –Ω–∞–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö.
- –°–¥–µ–ª–∞—Ç—å –ø—Ä–æ–≥–Ω–æ–∑—ã —Å –ø–æ–º–æ—â—å—é –æ–±—É—á–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏.
- –ü–æ—Å—á–∏—Ç–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –º–æ–¥–µ–ª–∏.
- –ó–∞–ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤ MLFlow –æ–±—É—á–µ–Ω–Ω—É—é –º–æ–¥–µ–ª—å, –º–µ—Ç—Ä–∏–∫–∏ –∏ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã.

–£—á–∏—Ç—ã–≤–∞—è, —á—Ç–æ –Ω–∞—à –Ω–∞–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –∏–º–µ–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω–æ–µ –∏–∑–º–µ—Ä–µ–Ω–∏–µ, –º—ã –±—É–¥–µ–º —Å–ª–µ–¥–æ–≤–∞—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º –¥–ª—è [Time Series Split](https://scikit-learn.org/stable/modules/cross_validation.html).

![Untitled](docs/images/Untitled%203.png)

–î–∞–≤–∞–π—Ç–µ —Ä–∞–∑–±–µ—Ä–µ–º –∫–æ–¥ –ø—Ä–∏–º–µ—Ä–∞ –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ ‚Äú**Log Metrics in multi-step training (K-Fold)‚Äù** 

```python
{...}
**for k, date in enumerate(experiment_batches):**
		
		# Define train data
    X_train = raw_data.loc[start_date_0:ref_end_data, numerical_features + categorical_features]
    y_train = raw_data.loc[start_date_0:ref_end_data, target] 

		# Define test data
		current = raw_data.loc[date[0]:date[1]]
    X_test = current.loc[:, numerical_features + categorical_features]
    y_test = current[target]
    
    # Train model {...}
		regressor = ensemble.RandomForestRegressor(random_state = 0, n_estimators = 50)
    regressor.fit(X_train, y_train)

		# Calculate metrics
    preds = regressor.predict(X_test)
    me = mean_squared_error(y_test, preds)
    mae = mean_absolute_error(y_test, preds)

		# Start a new MLflow Run
    with mlflow.start_run() as run: 
        
        # Log parameters
        mlflow.log_param("begin", date[0])
        mlflow.log_param("end", date[1])
        
        # Log metrics
        mlflow.log_metric('me', round(me, 3))
        mlflow.log_metric('mae', round(mae, 3))
        
        # Log model 
        mlflow.log_artifact(model_path)

    # Update reference end date
    ref_end_data = date[1]
```

–û—Ç–ª–∏—á–∏–µ —ç—Ç–æ–≥–æ –ø—Ä–∏–º–µ—Ä–∞ –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –≤ —Ç–æ–º, —á—Ç–æ –∑–¥–µ—Å—å —É –Ω–∞—Å –µ—Å—Ç—å —Ü–∏–∫–ª –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–∏ –ø–æ —Ñ–æ–ª–¥–∞–º. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–æ–ª–¥–∞ —Ä–∞—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –º–µ—Ç—Ä–∏–∫–∏.  

```bash

**for k, date in enumerate(experiment_batches):**
		...

		# Start a new MLflow Run
    with mlflow.start_run() as run: 
        
        # Log metrics
        mlflow.log_metric('me', round(me, 3))
        mlflow.log_metric('mae', round(mae, 3))
        ...
```

–í–∞–∂–Ω–æ–µ –æ—Ç–º–µ—Ç–∏—Ç—å, —á—Ç–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–æ–ª–¥–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤—ã–π –∑–∞–ø—É—Å–∫ (Run) –≤ MLflow, –∫—É–¥–∞ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ –º–µ—Ç—Ä–∏–∫–∏.  –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ —Å–ø–∏—Å–æ–∫ –∑–∞–ø—É—Å–∫–æ–≤ –≤ —Ä–∞–º–∫–∞—Ö —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞ "1-Train-K-Fold". –ö–∞–∂–¥—ã–π –∑–∞–ø—É—Å–∫ –≤ —Å–ø–∏—Å–∫–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –º–µ—Ç—Ä–∏–∫–∏ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ Fold. 

![Untitled](docs/images/Untitled%204.png)

–í—ã –º–æ–∂–µ—Ç–µ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å, –∫–∞–∫–∏–µ —Å—Ç–æ–ª–±—Ü—ã –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å –Ω–∞ –¥–∞—à–±–æ—Ä–¥–µ. –ü—Ä–æ—Å—Ç–æ –∑–∞–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª ¬´Columns¬ª –∏ –≤—ã–±–µ—Ä–µ—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã.

![Untitled](docs/images/Untitled%205.png)

### –®–∞–≥ 5 -  –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∑–∞–ø—É—Å–∫–æ–≤ (Nested Runs)

–í –ø—Ä–µ–¥—ã–¥—É—â–µ–º –ø—Ä–∏–º–µ—Ä–µ –∫–∞–∂–¥—ã–π –∑–∞–ø—É—Å–∫ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞ —Å–æ–∑–¥–∞–≤–∞–ª –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–µ–π (Runs) –≤ –¥–∞—à–±–æ—Ä–¥–µ, —á—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ –æ—á–µ–Ω—å —É–¥–æ–±–Ω–æ. –í –∫–æ–Ω—Ü–µ –∫–æ–Ω—Ü–æ–≤, –≤–∞–º —Å–∫–æ—Ä–µ–µ –±—É–¥–µ—Ç –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã –º–µ—Ç—Ä–∏–∫–∏ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–º —Ñ–æ–ª–¥–µ. –ò–º–µ–Ω–Ω–æ –ø–æ –º–µ—Ç—Ä–∏–∫–∞–º –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–º —Ñ–æ–ª–¥–µ (–∏ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å—Ä–µ–¥–Ω–∏–º –ø–æ —Ñ–æ–ª–¥–∞–º) –≤—ã –±—É–¥–µ—Ç–µ —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å –∑–∞–ø—É—Å–∫–∏ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤. 

–ù–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ –≤—ã –≤–Ω–µ—Å–µ—Ç–µ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:

- –ù–∞—Å—Ç—Ä–æ–∏—Ç–µ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫—É –∑–∞–ø—É—Å–∫–æ–≤ (Nested Runs)
- –î–æ–±–∞–≤–∏—Ç–µ –¥–∞—Ç—É –æ–∫–æ–Ω—á–∞–Ω–∏—è –±–∞—Ç—á–∞ –¥–ª—è –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è —Ñ–æ–ª–¥–æ–≤
- –ù–∞—Å—Ç—Ä–æ–∏—Ç–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç—Ä–∏–∫–∏ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–æ–ª–¥–∞
- –ù–∞—Å—Ç—Ä–æ–∏—Ç–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª—å —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ñ–æ–ª–¥–∞

–ß—Ç–æ–±—ã —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—É—Å–∫–∏  –≤ MLflow, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é "–≤–ª–æ–∂–µ–Ω–Ω—ã—Ö" –∑–∞–ø—É—Å–∫–æ–≤ (Nested Runs). –ü—Ä–∏–≤–µ–¥–µ–Ω–Ω—ã–π –Ω–∏–∂–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç –∫–æ–¥–∞ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å–∫—Ä–∏–ø—Ç–∞ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —ç—Ç–æ–≥–æ.

- –°–Ω–∞—á–∞–ª–∞ –∏–Ω–∏—Ü–∏–∏—Ä—É–π—Ç–µ –æ—Å–Ω–æ–≤–Ω–æ–π Run (–∏–ª–∏ Parent). Parent Run - —ç—Ç–æ –æ–¥–∏–Ω–æ—á–Ω—ã–π –∑–∞–ø—É—Å–∫ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞ —Å–æ –≤—Å–µ–º–∏ —Ñ–æ–ª–¥–∞–º–∏.
- –í–Ω—É—Ç—Ä–∏ Parent Run –∏–Ω–∏—Ü–∏–∏—Ä—É–π—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö (–∏–ª–∏ Nested)  –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–æ–ª–¥–∞. –î–ª—è —ç—Ç–æ–≥–æ –ø–µ—Ä–µ–¥–∞–π—Ç–µ –∞—Ä–≥—É–º–µ–Ω—Ç `nested=True` –≤ —Ñ—É–Ω–∫—Ü–∏—é `mlflow.start_run()`.
- –ü–µ—Ä–µ–¥–∞–π—Ç–µ –∞—Ä–≥—É–º–µ–Ω—Ç `run_name` –≤ —Ñ—É–Ω–∫—Ü–∏—é `mlflow.start_run()`, —á—Ç–æ–±—ã –∑–∞–¥–∞—Ç—å –∏–º—è –¥–ª—è Nested Run.

```python
# –ù–∞—á–∏–Ω–∞–µ–º –Ω–æ–≤—ã–π –ó–∞–ø—É—Å–∫ (–†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π –ó–∞–ø—É—Å–∫)
with mlflow.start_run() as run: 

    # –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–∞–∫–µ—Ç–∞ (K-Fold)
    for k, date in enumerate(experiment_batches):

        # –ó–∞–ø—É—Å–∫–∞–µ–º –î–æ—á–µ—Ä–Ω–∏–π –ó–∞–ø—É—Å–∫ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ Fold 
        with mlflow.start_run(run_name=date[1], nested=True) as child_run:
                        
            # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –î–æ—á–µ—Ä–Ω–∏–π –ó–∞–ø—É—Å–∫ (Fold)
            {...} 
        
    # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π –ó–∞–ø—É—Å–∫
		{...}
```

–î–∞–≤–∞–π—Ç–µ –æ–±—Å—É–¥–∏–º –¥–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.

–í–Ω—É—Ç—Ä–∏ Parent Run –≤—ã –∑–∞–ø—É—Å–∫–∞–µ—Ç –æ–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ —Å K-Fold –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–æ–ª–¥–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–π –¥–æ—á–µ—Ä–Ω–∏–π Nested Run, –≤ –∫–æ—Ç–æ—Ä—ã–π –≤—ã –ª–æ–≥–∏—Ä—É–µ—Ç–µ –º–µ—Ç—Ä–∏–∫–∏.  

–ü—Ä–∏ —ç—Ç–æ–º, –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–æ–ª–¥–∞ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ –æ–±—ä–µ–∫—Ç metrics, —á—Ç–æ–±—ã –∏—Ö –º–æ–∂–Ω–æ –±—ã–ª–æ –≤–ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–∏ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞—Ç—å. 

```python
# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ Fold
metrics = {}

# –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–∞–∫–µ—Ç–∞ (K-Fold)
for k, date in enumerate(experiment_batches):

    # –ö–æ–¥ –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–∏, –æ—Ç—á–µ—Ç–∞ –æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –º–µ—Ç—Ä–∏–∫...

    # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ –¥–ª—è —ç—Ç–æ–≥–æ –ø–∞–∫–µ—Ç–∞ –≤ —Å–ª–æ–≤–∞—Ä—å
    metrics.update({date[1]: {'me': me, 'mae': mae}})
```

–ù–∞–∫–æ–Ω–µ—Ü, –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∫—Ä–æ—Å—Å–≤–∞–ª–∏–¥–∞—Ü–∏–∏, –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç Parent Run, –≤ –∫–æ—Ç–æ—Ä–æ–º 

- —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç–µ –º–æ–¥–µ–ª—å –∏ –ª–æ–≥–∏—Ä—É–µ—Ç–µ –µ–µ –∫–∞–∫ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç Parent Run
- –≤—ã—á–∏—Å–ª—è–µ—Ç–µ —Å—Ä–µ–¥–Ω–∏–µ –º–µ—Ç—Ä–∏–∫–∏ –ø–æ –≤—Å–µ–º —Ñ–æ–ª–¥–∞–º –∏ –ª–æ–≥–∏—Ä—É–µ—Ç–µ –∏—Ö –≤ Parent Run

```python
# –ù–∞—á–∏–Ω–∞–µ–º –Ω–æ–≤—ã–π –ó–∞–ø—É—Å–∫ (–†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π –ó–∞–ø—É—Å–∫)
with mlflow.start_run() as run: 
    
    # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ –∫–∞–∂–¥–æ–≥–æ —Ñ–æ–ª–¥–∞ –≤ –æ–¥–∏–Ω –æ–±—ä–µ–∫—Ç
    metrics = {}

    # –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–∞–∫–µ—Ç–∞ (K-Fold)
    for k, date in enumerate(experiment_batches):
        
        # –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ {...}
        # –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ –∏–∑ –æ—Ç—á–µ—Ç–∞ {...}
        
        # –ó–∞–ø—É—Å–∫–∞–µ–º –î–æ—á–µ—Ä–Ω–∏–π –ó–∞–ø—É—Å–∫ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ Fold 
        with mlflow.start_run(run_name=date[1], nested=True) as child_run:
            
            # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç—Ä–∏–∫
            mlflow.log_metric('me', round(me, 3))
            mlflow.log_metric('mae', round(mae, 3))
            
            # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞ –æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ä–µ–≥—Ä–µ—Å—Å–∏–∏ –∫–∞–∫ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞
            mlflow.log_artifact(model_quality_report_path)
        
    # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ–π –º–æ–¥–µ–ª–∏
    joblib.dump(regressor, model_path)
    
    # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø–∞–∫–µ—Ç–∞ –∫–∞–∫ –†–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ –ó–∞–ø—É—Å–∫–∞
    mlflow.log_artifact(model_path)
    
    # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å—Ä–µ–¥–Ω–µ–Ω–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫ –≤ –†–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º –ó–∞–ø—É—Å–∫–µ
    average_run_merics = pd.DataFrame.from_dict(metrics).T.mean().round(3).to_dict()
    mlflow.log_metrics(average_run_merics )
```

–î–∞–≤–∞–π—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–∏–º, –∫–∞–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ MLFlow

![Untitled](docs/images/Untitled%206.png)

‚ö†Ô∏è¬†–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ:

- Parent Run –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —É—Å—Ä–µ–¥–Ω–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (–∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ –≤—Å–µ–º —Ñ–æ–ª–¥–∞–º)
- –æ–±—É—á–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ Parent Run
- –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∏–º–µ–Ω–∏ Nested Run (—Ñ–æ–ª–¥) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è —Ñ–æ–ª–¥–∞

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å MLFlow –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π —Å –∫—Ä–æ—Å—Å–≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –∏ –ª–æ–≥–∏—á–µ—Å–∫–∏ —Ä–∞–∑–¥–µ–ª–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞ –º–µ–∂–¥—É —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–º –∏ –≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏ Run. –≠—Ç–æ –¥–∞–µ—Ç –≤–∞–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É–≥–ª—É–±–∏—Ç—å—Å—è –≤ –¥–µ—Ç–∞–ª–∏ –∫–∞–∂–¥–æ–≥–æ —Ñ–æ–ª–¥–∞, —Å–æ—Ö—Ä–∞–Ω—è—è –ø—Ä–∏ —ç—Ç–æ–º –æ–±—â–∏–π –æ–±–∑–æ—Ä —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞. 

–≠—Ç–æ—Ç –ø–æ–¥—Ö–æ–¥ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ç–∞–∫–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –ø—Ä–∏ –æ–±—É—á–µ–Ω–∏–∏ –¥—Ä—É–≥–∏—Ö –º–æ–¥–µ–ª–µ–π —Å –±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –∏—Ç–µ—Ä–∞—Ü–∏–π –∏ —ç–ø–æ—Ö. 

### –®–∞–≥ 6 - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ú–µ—Ç—Ä–∏–∫ —Å–æ steps –∏–ª–∏ timestamps

–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ –ø–æ —à–∞–≥–∞–º –∏–ª–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–º –º–µ—Ç–∫–∞–º –≤ MLFlow –ø–æ–∑–≤–æ–ª—è–µ—Ç –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –º–æ–¥–µ–ª–∏ –Ω–∞ –ø—Ä–æ—Ç—è–∂–µ–Ω–∏–∏ –≤—Ä–µ–º–µ–Ω–∏ –æ–±—É—á–µ–Ω–∏—è. 

–í –æ—Ç–ª–∏—á–∏–µ –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —à–∞–≥–∞, —ç—Ç–æ—Ç –ø–æ–¥—Ö–æ–¥ –Ω–µ —Å–æ–∑–¥–∞–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã—Ö Nested Run –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–æ–ª–¥–∞. 

**–û–±—ä—è—Å–Ω–µ–Ω–∏–µ –ü—Ä–∏–º–µ—Ä–∞ –ö–æ–¥–∞**

1. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ö–ª–∏–µ–Ω—Ç–∞ MLFlow**:
    
    ```python
    MLFLOW_TRACKING_URI = "<http://localhost:5000>"
    mlflow.set_tracking_uri(MLFLOW_TRACKING_URI)
    client = MlflowClient()
    print(f"Client tracking uri: {client.tracking_uri}")
    
    ```
    
    –ó–¥–µ—Å—å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É MLFlow, –∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è –∫–ª–∏–µ–Ω—Ç –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º.
    
2. **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ò–º–µ–Ω–∏ –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞**:
    
    ```python
    mlflow.set_experiment('3-Metrics-by-steps')
    
    ```
    
    –ò–º—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞ –∑–∞–¥–∞–µ—Ç—Å—è –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –≤—Å–µ—Ö –∑–∞–ø—É—Å–∫–æ–≤ –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞.
    
3. **–ò–Ω–∏—Ü–∏–∞—Ü–∏—è –ù–æ–≤–æ–≥–æ –ó–∞–ø—É—Å–∫–∞ –≤ MLflow**:
    
    ```python
    with mlflow.start_run() as run:
    
    ```
    
    –ù–∞—á–∞–ª–æ –Ω–æ–≤–æ–≥–æ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞ (–∏–ª–∏ "–∑–∞–ø—É—Å–∫–∞") –≤ MLFlow.
    
4. **–û–±—É—á–µ–Ω–∏–µ –ú–æ–¥–µ–ª–∏ –¥–ª—è –ö–∞–∂–¥–æ–≥–æ –ü–∞–∫–µ—Ç–∞ (K-Fold)**:
–í —Ü–∏–∫–ª–µ –ø—Ä–æ—Ö–æ–¥–∏–º –ø–æ –∫–∞–∂–¥–æ–º—É –≤—Ä–µ–º–µ–Ω–Ω–æ–º—É –∏–Ω—Ç–µ—Ä–≤–∞–ª—É (–ø–∞–∫–µ—Ç—É) –∏ –æ–±—É—á–∞–µ–º –º–æ–¥–µ–ª—å.
    - **–í—ã—á–∏—Å–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –º–µ—Ç–∫–∏**:
        
        ```python
        timestamp = time.mktime(datetime.datetime.strptime(date[1], "%Y-%m-%d %H:%M:%S").timetuple())
        
        ```
        
        –ó–¥–µ—Å—å –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –≤—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –ø–∞–∫–µ—Ç–∞.
        
    - **–û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ –∏ —Ä–∞—Å—á–µ—Ç –º–µ—Ç—Ä–∏–∫**:
        
        ```python
        regressor.fit(X_train, y_train)
        preds = regressor.predict(X_test)
        me = mean_squared_error(y_test, preds)
        mae = mean_absolute_error(y_test, preds)
        
        ```
        
        –ü—Ä–æ—Ü–µ—Å—Å –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–∏ –∏ —Ä–∞—Å—á–µ—Ç –º–µ—Ç—Ä–∏–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.
        
5. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ú–µ—Ç—Ä–∏–∫ —Å –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ö–ª–∏–µ–Ω—Ç–∞**:
    
    ```python
    client.log_metric(run.info.run_id, 'me', round(me, 3), timestamp=int(timestamp)*1000)
    client.log_metric(run.info.run_id, 'mae', round(mae, 3), step=k)
    
    ```
    
    –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –≤—Ä–µ–º–µ–Ω–Ω–æ–π –º–µ—Ç–∫–∏ (`timestamp`) –∏ —à–∞–≥–∞ (`step`). –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–µ—Ç—Ä–∏–∫ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—Ä–µ–º–µ–Ω–∏ –∏–ª–∏ –∏—Ç–µ—Ä–∞—Ü–∏–∏ –æ–±—É—á–µ–Ω–∏—è.
    
6. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ú–æ–¥–µ–ª–∏ –∏ –ü–∞—Ä–∞–º–µ—Ç—Ä–æ–≤**:
    
    ```python
    mlflow.log_artifact(model_path)
    mlflow.log_param("begin", date[0])
    mlflow.log_param("end", date[1])
    
    ```
    
    –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞ –ø—É—Ç–µ–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –º–æ–¥–µ–ª–∏ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞.
    

**–ó–∞–∫–ª—é—á–µ–Ω–∏–µ**

–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ –ø–æ —à–∞–≥–∞–º –∏–ª–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–º –º–µ—Ç–∫–∞–º —è–≤–ª—è–µ—Ç—Å—è –∫–ª—é—á–µ–≤—ã–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–º –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –º–æ–¥–µ–ª–∏ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –æ–±—É—á–µ–Ω–∏—è. –≠—Ç–æ –æ—Å–æ–±–µ–Ω–Ω–æ –≤–∞–∂–Ω–æ –≤ —Å–ª—É—á–∞—è—Ö —Ä–∞–±–æ—Ç—ã —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∏–ª–∏ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Å–ª–æ–∂–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤ –≤–∞–ª–∏–¥–∞—Ü–∏–∏, —Ç–∞–∫–∏—Ö –∫–∞–∫ K-Fold Cross-Validation.

## üöÄ¬†3 - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª—è–º–∏ c MLFlow Model Registry

<aside>
üí° –í —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ –º—ã –±—É–¥–µ–º —Ä–∞–±–æ—Ç–∞—Ç—å —Å Jupyter Notebook `notebooks/3-model-registry.ipynb`

</aside>

–†–µ–µ—Å—Ç—Ä –º–æ–¥–µ–ª–µ–π MLflow (MLflow Model Registry) - —ç—Ç–æ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –º–æ–¥–µ–ª–µ–π, –Ω–∞–±–æ—Ä API –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª–Ω—ã–º –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –º–æ–¥–µ–ª–∏ MLflow. –û–Ω –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏—è–º–∏ –º–æ–¥–µ–ª–µ–π, –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–∏—Å–≤–∞–∏–≤–∞—Ç—å –∏–º –ø—Å–µ–≤–¥–æ–Ω–∏–º—ã, –¥–æ–±–∞–≤–ª—è—Ç—å —Ç–µ–≥–∏ –∏ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏, –∞ —Ç–∞–∫–∂–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ (–∏–∑ –∫–∞–∫–æ–≥–æ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞ –∏ –∑–∞–ø—É—Å–∫–∞ MLflow –±—ã–ª–∞ —Å–æ–∑–¥–∞–Ω–∞ –º–æ–¥–µ–ª—å).

**–û—Å–Ω–æ–≤–Ω—ã–µ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –†–µ–µ—Å—Ç—Ä–∞ –ú–æ–¥–µ–ª–µ–π MLflow**

1. **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –•—Ä–∞–Ω–∏–ª–∏—â–µ –ú–æ–¥–µ–ª–µ–π**:
–†–µ–µ—Å—Ç—Ä –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –µ–¥–∏–Ω–æ–µ –º–µ—Å—Ç–æ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞, –æ–±–ª–µ–≥—á–∞—è –¥–æ—Å—Ç—É–ø –∏ —Å–æ–≤–º–µ—Å—Ç–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π –≤ –∫–æ–º–∞–Ω–¥–µ.
2. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –í–µ—Ä—Å–∏—è–º–∏ –ú–æ–¥–µ–ª–µ–π**:
–†–µ–µ—Å—Ç—Ä –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ –º–æ–¥–µ–ª–∏, —á—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–º–∏ –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–∏ –º–æ–¥–µ–ª–µ–π.
3. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¢–µ–≥–æ–≤ –∏ –ê–Ω–Ω–æ—Ç–∞—Ü–∏–π**:
–¢–µ–≥–∏ –∏ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –º–æ–¥–µ–ª–∏, —á—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –º–æ–¥–µ–ª–µ–π.

### **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ú–æ–¥–µ–ª–∏ (UI)**

–°–ª–µ–¥—É–π—Ç–µ –ø—Ä–∏–≤–µ–¥–µ–Ω–Ω—ã–º –Ω–∏–∂–µ —à–∞–≥–∞–º, —á—Ç–æ–±—ã –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –≤–∞—à—É –º–æ–¥–µ–ª—å MLflow –≤ –†–µ–µ—Å—Ç—Ä–µ –ú–æ–¥–µ–ª–µ–π.

**–û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∑–∞–ø—É—Å–∫–∞ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞ (Run) –≤ MLflow**
–ü–µ—Ä–µ–π–¥–∏—Ç–µ –∫ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –¥–µ—Ç–∞–ª–µ–π —Ç–æ–≥–æ MLflow Run, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–∞–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–Ω—É—é –º–æ–¥–µ–ª—å MLflow, –∫–æ—Ç–æ—Ä—É—é –≤—ã —Ö–æ—Ç–∏—Ç–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å. –í—ã–±–µ—Ä–∏—Ç–µ –ø–∞–ø–∫—É –º–æ–¥–µ–ª–∏, —Å–æ–¥–µ—Ä–∂–∞—â—É—é –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º—É—é –º–æ–¥–µ–ª—å MLflow, –≤ —Ä–∞–∑–¥–µ–ª–µ "Artifacts".

![Untitled](docs/images/Untitled%207.png)

–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "Register Model‚Äù, –ø–æ—Å–ª–µ —á–µ–≥–æ –ø–æ—è–≤–∏—Ç—Å—è —Ñ–æ—Ä–º–∞.

–í –≤—ã–ø–∞–¥–∞—é—â–µ–º –º–µ–Ω—é "Model‚Äù –Ω–∞ —Ñ–æ—Ä–º–µ –≤—ã –º–æ–∂–µ—Ç–µ –ª–∏–±–æ –≤—ã–±—Ä–∞—Ç—å "–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –º–æ–¥–µ–ª—å" (Create New Model), —á—Ç–æ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ —Å–æ–∑–¥–∞–Ω–∏—é –Ω–æ–≤–æ–π –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ —Å –≤–∞—à–µ–π –º–æ–¥–µ–ª—å—é MLflow –≤ –∫–∞—á–µ—Å—Ç–≤–µ –µ—ë –Ω–∞—á–∞–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏, –ª–∏–±–æ –≤—ã–±—Ä–∞—Ç—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—É—é –º–æ–¥–µ–ª—å, –≤ —Ä–∞–º–∫–∞—Ö –∫–æ—Ç–æ—Ä–æ–π –≤–∞—à–∞ –º–æ–¥–µ–ª—å –±—É–¥–µ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∞ –∫–∞–∫ –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è. –ù–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–µ –Ω–∏–∂–µ –ø–æ–∫–∞–∑–∞–Ω –ø—Ä–æ—Ü–µ—Å—Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –º–æ–¥–µ–ª–∏ MLflow –≤ –Ω–æ–≤–æ–π –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ –ø–æ–¥ –Ω–∞–∑–≤–∞–Ω–∏–µ–º "iris_model_testing".

![Untitled](docs/images/Untitled%208.png)

### **–ù–∞–π—Ç–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ (UI)**

–ü–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤–∞—à–∏—Ö –º–æ–¥–µ–ª–µ–π –≤ –†–µ–µ—Å—Ç—Ä–µ –ú–æ–¥–µ–ª–µ–π, –≤—ã –º–æ–∂–µ—Ç–µ –Ω–∞–π—Ç–∏ –∏—Ö —Å–ª–µ–¥—É—é—â–∏–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏.

- **–ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ú–æ–¥–µ–ª–µ–π**:
–≠—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å—Å—ã–ª–∫–∏ –Ω–∞ –≤–∞—à–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –≤–µ—Ä—Å–∏–∏ –º–æ–¥–µ–ª–µ–π.

![Untitled](docs/images/Untitled%209.png)

- **–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –†–∞–∑–¥–µ–ª –ê—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≤–∞—à–µ–≥–æ MLflow Run**:
–ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –ø–∞–ø–∫—É –º–æ–¥–µ–ª–∏, –∞ –∑–∞—Ç–µ–º –∫–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –≤–µ—Ä—Å–∏—é –º–æ–¥–µ–ª–∏ –≤ –≤–µ—Ä—Ö–Ω–µ–º –ø—Ä–∞–≤–æ–º —É–≥–ª—É, —á—Ç–æ–±—ã –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤–µ—Ä—Å–∏—é, —Å–æ–∑–¥–∞–Ω–Ω—É—é –∏–∑ —ç—Ç–æ–π –º–æ–¥–µ–ª–∏.

![Untitled](docs/images/Untitled%2010.png)

### –†–∞–±–æ—Ç–∞ —Å –†–µ–µ—Å—Ç—Ä–æ–º –ú–æ–¥–µ–ª–µ–π MLflow –ß–µ—Ä–µ–∑ API

–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –†–µ–µ—Å—Ç—Ä–æ–º –ú–æ–¥–µ–ª–µ–π - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ MLflow `model flavor` –∏–ª–∏ API –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞ MLflow. –í —á–∞—Å—Ç–Ω–æ—Å—Ç–∏, –≤—ã –º–æ–∂–µ—Ç–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –º–æ–¥–µ–ª—å –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞ MLflow –∏–ª–∏ –ø–æ—Å–ª–µ –≤—Å–µ—Ö –≤–∞—à–∏—Ö —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ã—Ö –∑–∞–ø—É—Å–∫–æ–≤.

**–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ú–æ–¥–µ–ª–∏**

–ò–ø–æ–ª—å–∑—É–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä `registered_model_name` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –º–æ–¥–µ–ª–∏.

- –ï—Å–ª–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –º–µ—Ç–æ–¥ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –Ω–æ–≤—É—é –º–æ–¥–µ–ª—å –∏ —Å–æ–∑–¥–∞–µ—Ç –í–µ—Ä—Å–∏—é 1.
- –ï—Å–ª–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –º–æ–¥–µ–ª—å —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –º–µ—Ç–æ–¥ —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é –º–æ–¥–µ–ª–∏.

**–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è**:
–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–ª–µ–¥—É—é—â—É—é —è—á–µ–π–∫—É –∫–æ–¥–∞ **3 —Ä–∞–∑–∞**, —á—Ç–æ–±—ã –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å 3 –≤–µ—Ä—Å–∏–∏ –º–æ–¥–µ–ª–∏ "bike-sharing-RandomForestRegressor".

```python
from mlflow.models import infer_signature

with mlflow.start_run() as run:
    # –í—ã–≤–æ–¥ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–æ–∑–¥–∞–Ω–Ω–æ–º –∑–∞–ø—É—Å–∫–µ
    print("ID —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞: {}".format(run.info.experiment_id))
    print("ID –∑–∞–ø—É—Å–∫–∞: {}".format(run.info.run_id))
    print("–ò–º—è –∑–∞–ø—É—Å–∫–∞: {}".format(run.info.run_name))
    print('MLFlow tracking uri:', mlflow.get_tracking_uri())
    print('MLFlow artifact uri:', mlflow.get_artifact_uri())
    run_id = run.info.run_id

    # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–∏–≥–Ω–∞—Ç—É—Ä—ã –º–æ–¥–µ–ª–∏
    signature = infer_signature(y_test, preds_rf)

    # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏ sklearn –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–∞–∫ –≤–µ—Ä—Å–∏—è 1
    mlflow.sklearn.log_model(
        sk_model=model_rf,
        artifact_path="RandomForest",
        signature=signature,
        registered_model_name="RandomForest",
    )
```

**–ù–∞–π—Ç–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ (API)**

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `client.search_registered_models()` –¥–ª—è –ø–æ–∏—Å–∫–∞ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π.

```python
from pprint import pprint

# –°–ø–∏—Å–æ–∫ –∏ –ø–æ–∏—Å–∫ –º–æ–¥–µ–ª–µ–π MLflow
for rm in client.search_registered_models():
    pprint(dict(rm), indent=4)
```

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞–¥–∏–∏ –º–æ–¥–µ–ª–∏ –≤ (Dev ‚Üí Production)**
–ú–æ–¥–µ–ª—å –ø—Ä–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ —Ä–∞–∑–Ω—ã–µ —Å—Ç–∞–¥–∏–∏ –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞: –æ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –¥–æ —Å—Ç–∞–¥–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏ (Production).

```python
client.transition_model_version_stage(
    name="RandomForest", 
    version=3, 
    stage="Production"
)
```

**–ó–∞–≥—Ä—É–∑–∫–∞ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π –∏–∑ Model Registry**
–ó–∞–≥—Ä—É–∑–∏—Ç–µ –º–æ–¥–µ–ª—å –∏–∑ —Ä–µ–µ—Å—Ç—Ä–∞ –∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –µ—ë –¥–ª—è —Ä–∞–±–æ—Ç—ã.

```python
model_uri = "models:/RandomForest/3"
loaded_model = mlflow.sklearn.load_model(model_uri)
loaded_model

```

**–û—Ç–º–µ–Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏, —É–¥–∞–ª–µ–Ω–∏–µ –∏ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ –ú–æ–¥–µ–ª–µ–π**
–ü–µ—Ä–µ–≤–æ–¥–∏—Ç–µ –≤–µ—Ä—Å–∏–∏ –º–æ–¥–µ–ª–µ–π –∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞ –≤ –∞—Ä—Ö–∏–≤ –∏ —É–¥–∞–ª—è–π—Ç–µ –∏—Ö –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.

```python
client = MlflowClient()
client.transition_model_version_stage(
    name="RandomForest", version=2, stage="Archived"
)

# –£–¥–∞–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–∏ 1 –º–æ–¥–µ–ª–∏
client.delete_model_version(
    name="RandomForest", version=1,
)

```

–í —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ –≤—ã –Ω–∞—É—á–∏–ª–∏—Å—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å API MLflow –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ä–µ–µ—Å—Ç—Ä–æ–º –º–æ–¥–µ–ª–µ–π, –≤–∫–ª—é—á–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é, –ø–æ–∏—Å–∫, –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞–¥–∏–π, –∑–∞–≥—Ä—É–∑–∫—É –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ, –∞ —Ç–∞–∫–∂–µ –æ—Ç–º–µ–Ω—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏, —É–¥–∞–ª–µ–Ω–∏–µ –∏ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π. –≠—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ–º–æ–≥–∞—é—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –º–æ–¥–µ–ª–µ–π –¥–ª—è —Ü–µ–ª–µ–π MLOps. 

## **üîó –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã**

- Getting Started with MLflow: [https://mlflow.org/docs/latest/getting-started/index.html](https://mlflow.org/docs/latest/getting-started/index.html)
- MLflow Model Registry: [https://mlflow.org/docs/latest/model-registry.html#ui-workflow](https://mlflow.org/docs/latest/model-registry.html#ui-workflow)